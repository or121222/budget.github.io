<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neto</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4e54c8">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* === THEME VARIABLES === */
        :root {
            --bg-color: #f0f2f5;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #2d3436;
            --text-sec: #636e72;
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --danger: #ff7675;
            --success: #00b894;
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            --nav-height: 70px;
            --safe-area-top: env(safe-area-inset-top, 20px);
        }

        body.dark-mode {
            --bg-color: #1e272e;
            --card-bg: rgba(45, 52, 54, 0.95);
            --text-main: #dfe6e9;
            --text-sec: #b2bec3;
            --primary: #6c5ce7;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Rubik', sans-serif; background-color: var(--bg-color); color: var(--text-main); padding-bottom: 100px; user-select: none; overflow-x: hidden; }

        /* --- Layout --- */
        .page { display: none; animation: fadeIn 0.3s ease; padding-bottom: 80px; }
        .page.active { display: block; }

        /* --- Header --- */
        header.app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: calc(var(--safe-area-top) + 15px) 20px 30px 20px;
            border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;
            color: white; text-align: center; box-shadow: 0 10px 30px rgba(78, 84, 200, 0.4); margin-bottom: 20px;
            position: relative;
        }

        /* Hamburger Button */
        /* ×›×¤×ª×•×¨ ×”××‘×•×¨×’×¨ ××©×•×“×¨×’ - ×¦×£ ×•×¡×’×•×œ */
.menu-btn {
    position: fixed; /* ×©×™× ×•×™ ×-absolute ×œ-fixed ×›×“×™ ×©×™×™×©××¨ ×§×‘×•×¢ ×‘××¡×š */
    top: 50px;
    right: 20px;
    /* ×”×¨×§×¢ ×”×¡×’×•×œ ×©×œ ×”××¤×œ×™×§×¦×™×” */
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    color: white;
    width: 45px;
    height: 45px;
    border-radius: 50%; /* ×¢×’×•×œ ×•×™×¤×” ×™×•×ª×¨ */
    font-size: 1.2rem;
    cursor: pointer;
    z-index: 1200; /* ×©×™×”×™×” ××¢×œ ×”×ª×¤×¨×™×˜ ×¢×¦××• */
    box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* ×¦×œ×œ×™×ª ×œ×”×¤×¨×“×” */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s;
}
        /* ××—×œ×§×” ×©×ª×¤×§×™×“×” ×œ× ×¢×•×œ ××ª ×”××¡×š */
body.no-scroll { overflow: hidden; }
.menu-btn:active { transform: scale(0.9); }

        .total-balance { font-size: 3rem; font-weight: 700; direction: ltr; margin: 5px 0 15px 0; text-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .month-selector { display: flex; justify-content: center; align-items: center; gap: 20px; font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 20px; }
        .month-arrow { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 1rem; padding: 8px 12px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(4px); }
        
        .header-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .h-input-box { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 10px; backdrop-filter: blur(5px); text-align: center; }
        .h-input-box label { font-size: 0.8rem; opacity: 0.9; display: block; margin-bottom: 2px; }
        .h-input-box input { width: 100%; background: transparent; border: none; text-align: center; font-size: 1.2rem; font-weight: bold; color: white; }
        .h-input-box input::placeholder { color: rgba(255,255,255,0.6); }
        .motivation-box { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 10px 15px; margin-top: 10px; backdrop-filter: blur(4px); min-height: 40px; display: flex; align-items: center; justify-content: center; }
        .motivation-text { color: rgba(255,255,255,0.95); font-size: 1rem; font-style: italic; }

        /* --- Side Menu --- */
        .side-menu-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; opacity: 0; pointer-events: none; transition: 0.3s; }
        .side-menu-overlay.open { opacity: 1; pointer-events: all; }
        .side-menu { position: fixed; top: 0; right: -280px; bottom: 0; width: 280px; background: var(--card-bg); z-index: 1001; transition: 0.3s; padding: 100px 20px 20px 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 10px; }
        .side-menu.open { right: 0; }
        .menu-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 12px; color: var(--text-main); font-weight: 500; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .menu-item:hover { background: rgba(0,0,0,0.05); }
        .menu-item.active { background: var(--primary); color: white; }

        /* --- Components --- */
        .filter-bar { display: flex; gap: 10px; padding: 0 15px; margin-bottom: 15px; justify-content: flex-end; }
        .filter-select { background: var(--card-bg); border: 1px solid rgba(0,0,0,0.1); padding: 8px; border-radius: 10px; font-size: 0.9rem; color: var(--text-main); }
        
        #categories-container { max-width: 800px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 15px; }
        .category-card { background: var(--card-bg); border-radius: 15px; box-shadow: var(--shadow); border: var(--glass-border); overflow: hidden; backdrop-filter: blur(10px); }
        .card-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .cat-info { display: flex; align-items: center; gap: 10px; }
        .cat-emoji { background: rgba(100,100,100,0.1); width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.4rem; }
        .cat-limit { font-size: 0.8rem; color: var(--text-sec); text-decoration: underline; cursor: pointer; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; }
        .current-spend { font-size: 1.1rem; font-weight: bold; direction: ltr; }
        .progress-track { height: 6px; background: rgba(0,0,0,0.05); margin: 0 15px 10px 15px; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s ease; border-radius: 3px; }
        .bg-green { background: var(--success); } .bg-yellow { background: var(--warning); } .bg-red { background: var(--danger); }
        .items-list { list-style: none; border-top: 1px solid rgba(0,0,0,0.05); }
        .item-row { display: flex; justify-content: space-between; padding: 12px 15px; border-bottom: 1px solid rgba(0,0,0,0.03); font-size: 0.95rem; }
        .amount-pos { color: var(--success); font-weight: bold; } .amount-neg { color: var(--danger); font-weight: bold; }
        .pay-method-icon { margin-left: 8px; font-size: 0.8rem; color: var(--text-sec); }

        .quick-add { padding: 15px; background: rgba(0,0,0,0.02); display: flex; flex-direction: column; gap: 10px; }
        .qa-row { display: flex; gap: 10px; }
        .qa-input { padding: 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1); background: var(--card-bg); color: var(--text-main); font-size: 1rem; flex: 1; min-width: 0; }
        .qa-btn { background: var(--text-main); color: var(--bg-color); border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; display: flex; justify-content: center; align-items: center; gap: 5px; }

        /* --- Savings --- */
        .savings-container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .saving-card { color: white; border-radius: 15px; padding: 15px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        .saving-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .saving-progress-bg { background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px; overflow: hidden; }
        .saving-progress-fill { background: white; height: 100%; width: 0%; transition: 0.5s; }
        .color-opt { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; }
        .color-opt.selected { border-color: #333; transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* --- Chart --- */
        .chart-container-card { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .chart-wrapper { background: var(--card-bg); border-radius: 15px; box-shadow: var(--shadow); border: var(--glass-border); padding: 15px; height: 320px; position: relative; }
        .chart-toggle { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.05); border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; z-index: 10; }

        /* --- Recurring Specifics --- */
        .recur-add-box { background: var(--card-bg); padding: 20px; margin: 15px; border-radius: 15px; box-shadow: var(--shadow); }
        .btn-primary { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .ad-spacer { height: 60px; width: 100%; display: block; }
        .fab { position: fixed; bottom: 20px; left: 20px; background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; box-shadow: 0 4px 15px rgba(78, 84, 200, 0.5); cursor: pointer; border: none; z-index: 95; }
        
        /* --- Modals --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center; padding: 20px; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-card { background: var(--bg-color); width: 100%; max-width: 400px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; }
        .emoji-grid { display: flex; gap: 5px; justify-content: center; margin-bottom: 10px; }
        .emoji-opt { font-size: 1.5rem; cursor: pointer; padding: 5px; border-radius: 5px; }

        /* --- SSC (Calculator) Styles --- */
        .ssc-wrap { padding: 15px; font-family:"Rubik", sans-serif; color: var(--text-main); }
        .ssc-header-container { text-align: center; margin-top: 40px; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .ssc-glass-badge { background: rgba(255,255,255,0.2); color: #fff; padding: 6px 16px; border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; font-size: 0.9rem; font-weight: 500; backdrop-filter: blur(5px); }
        .ssc-glass-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; cursor: pointer; backdrop-filter: blur(5px); display: inline-flex; align-items: center; gap: 6px; transition: 0.2s; }
        
        .ssc-panel { background: var(--card-bg); border: var(--glass-border); border-radius: 16px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; backdrop-filter: blur(10px); }
        .ssc-row { display:flex; flex-wrap:wrap; gap:12px; align-items:end; margin-bottom: 10px; }
        .ssc-inp { appearance:none; border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.8); padding: 12px; border-radius: 12px; font-size: 1rem; outline:none; transition:.2s; width: 100%; color: var(--text-main); }
        .ssc-btn { border:none; padding:10px 16px; border-radius:12px; font-weight:600; cursor:pointer; transition:.2s; font-size:14px; display:inline-flex; align-items:center; justify-content:center; gap:6px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ssc-btn.acc { background:var(--success); color:#fff; } .ssc-btn.ghost { background:transparent; border: 1px solid var(--glass-border); color: var(--text-sec); }
        .ssc-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; }
        .ssc-card { background: var(--card-bg); border: var(--glass-border); border-radius: 16px; padding: 16px; box-shadow: var(--shadow); display:flex; flex-direction:column; gap:10px; position:relative; }
        .ssc-del-cat { position:absolute; top:8px; left:8px; width: 24px; height: 24px; border-radius: 50%; background: rgba(255, 118, 117, 0.1); color: var(--danger); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size: 12px; }
        .ssc-counter { display:flex; gap:8px; align-items:center; justify-content:space-between; background: rgba(0,0,0,0.03); padding:6px; border-radius: 12px; margin-top: auto; }
        .ssc-count { font-size:1.2rem; font-weight:700; min-width:30px; text-align:center; color: var(--primary); }
        .ssc-iconbtn { background:#fff; width:34px; height:34px; border-radius:10px; font-size:1.2rem; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: var(--text-sec); }
        .ssc-summary { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; background: linear-gradient(135deg, #fff, #f9f9f9); border: var(--glass-border); border-radius:16px; padding:20px; box-shadow: var(--shadow); text-align: center; }
        .ssc-total { font-size:1.4rem; font-weight:800; color: var(--primary); margin-top: 5px; }
        .ssc-table { width:100%; border-collapse:collapse; margin-top:10px; border-radius:10px; overflow:hidden; font-size: 0.9rem; }
        .ssc-table th { background: rgba(78, 84, 200, 0.1); color: var(--primary); padding:12px; text-align:center; font-weight:600; }
        .ssc-table td { padding:12px; border-bottom:1px solid rgba(0,0,0,0.05); text-align:center; }
        .ssc-editor-slice { display:flex; gap:8px; margin-bottom:8px; align-items:flex-end; background: rgba(0,0,0,0.02); padding: 10px; border-radius: 10px; }
        .ssc-btn-close-slice { width: 30px; height: 30px; border-radius: 50%; background: #fff; border: 1px solid #eee; color: var(--danger); display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 2px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>

    <div id="menu-overlay" class="side-menu-overlay" onclick="toggleMenu()"></div>
    <div id="side-menu" class="side-menu">
        <h2 style="color:var(--primary); padding-left:10px;">×ª×¤×¨×™×˜</h2>
        <div class="menu-item active" onclick="navTo('dashboard')"><i class="fas fa-home"></i> ×¨××©×™</div>
        <div class="menu-item" onclick="navTo('recurring')"><i class="fas fa-sync-alt"></i> ×§×‘×•×¢×•×ª</div>
        <div class="menu-item" onclick="navTo('calc')"><i class="fas fa-calculator"></i> ××—×©×‘×•×Ÿ ×©×›×¨</div>
        <div class="menu-item" onclick="navTo('premium')"><i class="fas fa-star"></i> ×¤×¨×™××™×•×</div>
        <div class="menu-divider" style="height:1px;background:rgba(0,0,0,0.1);margin:10px 0;"></div>
        <div class="menu-item" onclick="openSettingsModal()"><i class="fas fa-cog"></i> ×’×™×‘×•×™ ×•×©×—×–×•×¨</div>
        <div class="menu-item" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> ××¦×‘ ×œ×™×œ×”</div>
    </div>

    <div id="page-dashboard" class="page active">
        <header class="app-header">
            <div style="height:20px"></div>
            <div style="font-weight:700">Neto</div>
            <div class="month-selector">
                <button class="month-arrow" onclick="changeMonth(-1)"><i class="fas fa-chevron-right"></i></button>
                <span id="current-month-display">--</span>
                <button class="month-arrow" onclick="changeMonth(1)"><i class="fas fa-chevron-left"></i></button>
            </div>
            <div class="total-balance" id="global-balance">â‚ª0.00</div>
            <div class="header-inputs">
                <div class="h-input-box"><label>×¢×•"×© ×‘×‘× ×§</label><input type="number" id="bank-input" placeholder="0" oninput="saveAndRender()"></div>
                <div class="h-input-box"><label>××©×›×•×¨×ª</label><input type="number" id="salary-input" placeholder="0" oninput="updateSalary()"></div>
            </div>
            <div class="motivation-box"><i class="fas fa-quote-right" style="margin-left:5px; opacity:0.8"></i><span class="motivation-text" id="motivation-text">×˜×•×¢×Ÿ...</span></div>
        </header>

        <div class="filter-bar">
            <select id="cat-filter" class="filter-select" onchange="renderApp()"><option value="all">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
        </div>

        <div id="categories-container"></div>
        
        <div class="savings-container">
            <h3 style="margin-bottom:10px; color:var(--text-main)"><i class="fas fa-piggy-bank"></i> ×§×•×¤×•×ª ×—×™×¡×›×•×Ÿ</h3>
            <div id="savings-list"></div>
            <button class="btn-primary" style="background:var(--success); margin-top:5px;" onclick="openGoalModal()">+ ×™×¢×“ ×—×“×©</button>
        </div>

        <div class="chart-container-card">
            <div class="chart-wrapper">
                <button class="chart-toggle" onclick="toggleChartType()"><i class="fas fa-exchange-alt"></i> ×”×—×œ×£ ×ª×¦×•×’×”</button>
                <div style="position: relative; height: 100%; width: 100%;">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
      <div style="text-align:center; font-size:12px; color:#888; margin-top: 20px; padding-bottom: 100px;">
            Â© All rights reserved for Neto App , Developer: Cohen's.
        </div>
        <div class="ad-spacer"></div>
        <button class="fab" onclick="openCategoryModal()"><i class="fas fa-plus"></i></button>
    </div>

    <div id="page-recurring" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2>×”×•×¦××•×ª ×§×‘×•×¢×•×ª</h2>
        </header>
        
        <div class="recur-add-box">
            <h3 style="margin-top:0; color:var(--primary); margin-bottom:15px;">+ ×”×•×¡×¤×” ×—×“×©×”</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="rec-desc" class="qa-input" style="flex:2; min-width:0;" placeholder="×©× (×œ××©×œ: × ×˜×¤×œ×™×§×¡)">
                <input type="number" id="rec-amount" class="qa-input" style="flex:1; min-width:0;" placeholder="×¡×›×•×">
            </div>
            <select id="rec-cat-select" class="qa-input" style="width:100%; margin-top:10px; margin-bottom:10px;"></select>
            <button class="btn-primary" onclick="addRecurringSetting()" style="width: 50%; margin: 10px auto; display: block;">×©××•×¨ ×”×•×¨××”</button>
        </div>

        <div class="ssc-panel" style="margin: 0 15px;">
            <h3 style="margin-top:0; margin-bottom:10px; color:var(--text-main);">×¨×©×™××ª ×”×•×¨××•×ª ×¤×¢×™×œ×•×ª</h3>
            <div style="overflow-x:auto;">
                <table class="ssc-table" style="width:100%;">
                    <thead>
                        <tr>
                            <th style="text-align:right">×©×</th>
                            <th style="text-align:right">×§×˜×’×•×¨×™×”</th>
                            <th style="text-align:center">×¡×›×•×</th>
                            <th style="text-align:center">××—×§</th>
                        </tr>
                    </thead>
                    <tbody id="recurring-list-container"></tbody>
                </table>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-calc" class="page">
        <header class="app-header" style="padding-bottom: 40px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;">
            <div style="height:20px"></div>
            <div class="ssc-header-container" style="margin: 0; color:white;">
                <h2 style="margin:0; font-size:3rem; font-weight:700; text-shadow: 0 4px 10px rgba(0,0,0,0.15);">×—×™×©×•×‘ ×©×›×¨</h2>
                <div class="ssc-controls-row">
                    <span id="ssc_modeBadge" class="ssc-glass-badge">××¦×‘ ×¢×¨×™×›×” ×—×•×¤×©×™</span>
                    <button class="ssc-glass-btn" onclick="sscResetMonth()"><i class="fas fa-sync-alt"></i> ××™×¤×•×¡</button>
                </div>
            </div>
        </header>
        <div class="ssc-wrap" style="margin-top: -20px;">
            <section class="ssc-panel">
                <div class="ssc-row">
                    <label style="flex:1"><small>×©×›×¨ ×œ×©×¢×”</small><input id="ssc_hourly" type="number" step="0.1" placeholder="0" class="ssc-inp"></label>
                    <label style="flex:1"><small>×—×•×“×©</small><input id="ssc_month" type="month" class="ssc-inp"></label>
                </div>
            </section>
            <section class="ssc-panel" id="ssc_editorPanel">
                <h3 style="margin-top:0;color:var(--primary)">×”×•×¡×¤×ª ×¡×•×’ ××©××¨×ª</h3>
                <input type="text" id="ssc_newShiftName" placeholder="×©×" class="ssc-inp" style="margin-bottom:10px;">
                <div id="ssc_newShiftSlices"></div>
                <div style="display:flex; justify-content:space-between; margin-top:10px;">
                    <button class="ssc-btn ghost" onclick="sscAddEditorSlice()" style="font-size:12px;">+ ×”×•×¡×£ ××“×¨×’×”</button>
                    <button class="ssc-btn acc" id="ssc_saveTemplateBtn">×©××•×¨ ×¡×•×’</button>
                </div>
            </section>
            <section class="ssc-panel" style="background:transparent; border:none; padding:0; box-shadow:none;">
                <div class="ssc-grid" id="ssc_grid"></div>
                <div id="ssc_emptyState" style="text-align:center;padding:40px;color:#999;font-size:14px; background:rgba(255,255,255,0.5); border-radius:16px;">××™×Ÿ ××©××¨×•×ª ××•×’×“×¨×•×ª</div>
            </section>
            <div class="ssc-summary" style="margin-top:20px">
                <div><div class="ssc-meta">××©××¨×•×ª</div><div class="ssc-total" id="ssc_totalShifts">0</div></div>
                <div><div class="ssc-meta">×©×¢×•×ª</div><div class="ssc-total" id="ssc_totalHours">0</div></div>
                <div><div class="ssc-meta">×©×›×¨</div><div class="ssc-total" id="ssc_grandTotal" style="color:var(--success)">â‚ª0</div></div>
            </div>
            <div class="ssc-panel" style="margin-top:16px">
                <div style="font-weight:700;margin-bottom:12px; color:var(--text-main);">××—×©×‘×•×Ÿ ×—×•×¤×©×™ (×ª×•×¡×¤×•×ª)</div>
                <div style="display:flex; gap:10px; margin-bottom:5px; font-size:0.8rem; color:var(--text-sec); padding:0 5px;">
                    <span style="flex:2">×ª×™××•×¨</span><span style="flex:1; text-align:center">×©×¢×•×ª</span><span style="flex:1; text-align:center">××—×•×– %</span><span style="width:30px"></span>
                </div>
                <div id="ssc_quickRows"></div>
                <div class="ssc-row" style="margin-top:12px"><button class="ssc-btn acc" onclick="sscAddQuickRow()" style="font-size:12px; width:100%;">+ ×”×•×¡×£ ×©×•×¨×”</button></div>
                <div style="text-align:left; margin-top:10px; font-weight:bold; color:var(--text-sec);">×¡×”×´×› ×ª×•×¡×¤×•×ª: <span id="ssc_quickSum">0</span></div>
            </div>
            <section class="ssc-panel">
                <h3 style="margin-bottom:10px; color:var(--text-main);">×¤×™×¨×•×˜ ××œ×</h3>
                <div style="overflow-x:auto">
                    <table class="ssc-table">
                        <thead><tr><th>×¡×•×’</th><th>×›××•×ª</th><th>×©×¢×•×ª</th><th>×¡×”×´×›</th></tr></thead>
                        <tbody id="ssc_details"></tbody>
                        <tfoot><tr><td colspan="3">×¡×”×´×› ×›×•×œ×œ</td><td id="ssc_detailsTotal">0</td></tr></tfoot>
                    </table>
                </div>
            </section>
            <div class="ssc-secret-box" style="display:flex; justify-content:center; gap:5px; margin-top:20px; opacity:0.5;">
                <input type="text" id="ssc_secretCode" class="ssc-inp" placeholder="×§×•×“..." style="width:100px; text-align:center;">
                <button class="ssc-btn info" id="ssc_secretBtn">×”×¤×¢×œ</button>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-premium" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2>Premium</h2>
        </header>
        <div id="premium-content" style="padding: 20px; text-align: center;">
            <div style="background: linear-gradient(135deg, #FFD700, #FDB931); padding:30px; border-radius:20px; color:#333; box-shadow:0 10px 20px rgba(0,0,0,0.1);">
                <h1><i class="fas fa-crown"></i></h1>
                <h2>×©×“×¨×•×’ ×œ×¤×¨×•</h2>
                <p>×”×¡×¨×ª ×¤×¨×¡×•××•×ª, ×’×™×‘×•×™ ×‘×¢× ×Ÿ ×•×ª××™×›×”.</p>
                <button class="btn-primary" style="background:#333; margin-top:20px" onclick="buyPremium()">×”×™×¨×©× (â‚ª9.90)</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×”×’×“×¨×•×ª ×•×’×™×‘×•×™</h3>
            <button class="btn-primary" onclick="exportDataJSON()" style="margin-bottom:10px; background:var(--primary)"><i class="fas fa-share-alt"></i> ×’×™×‘×•×™ ××œ× (×©×ª×£)</button>
            <label class="btn-primary" style="background:var(--secondary); display:block; cursor:pointer; margin-bottom:10px"><i class="fas fa-file-import"></i> ×©×—×–×•×¨ ××’×™×‘×•×™<input type="file" onchange="importDataJSON(this)" style="display:none"></label>
            <button class="btn-primary" onclick="exportToCSV()" style="margin-bottom:10px; background:var(--success)"><i class="fas fa-file-csv"></i> ×™×™×¦×•× ×œ××§×¡×œ (×©×ª×£)</button>
            <button class="btn-primary" style="background:#ccc; color:#333; margin-top:10px" onclick="toggleMenu(); document.getElementById('settings-modal').classList.remove('open')">×¡×’×•×¨</button>
        </div>
    </div>

    <div id="goal-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×™×¢×“ ×—×™×¡×›×•×Ÿ ×—×“×©</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="new-goal-emoji" class="qa-input" style="width:60px; text-align:center;" value="âœˆï¸" placeholder="×¡××œ">
                <input type="text" id="new-goal-name" class="qa-input" style="flex:1;" placeholder="×©× ×”×™×¢×“">
            </div>
            <input type="number" id="new-goal-target" class="qa-input" style="width:100%; margin-bottom:15px" placeholder="×¡×›×•× ×™×¢×“">
            <label style="display:block; margin-bottom:8px; font-size:0.9rem;">×‘×—×¨ ×¦×‘×¢:</label>
            <div class="color-picker-row" style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;">
                <div class="color-opt selected" onclick="selectGoalColor(this, 'linear-gradient(135deg, #a8e063, #56ab2f)')" style="background: linear-gradient(135deg, #a8e063, #56ab2f);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #ff9966, #ff5e62)')" style="background: linear-gradient(135deg, #ff9966, #ff5e62);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #56CCF2, #2F80ED)')" style="background: linear-gradient(135deg, #56CCF2, #2F80ED);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #834d9b, #d04ed6)')" style="background: linear-gradient(135deg, #834d9b, #d04ed6);"></div>
            </div>
            <input type="hidden" id="new-goal-color" value="linear-gradient(135deg, #a8e063, #56ab2f)">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('goal-modal').classList.remove('open')">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmAddGoal()">×©××•×¨</button></div>
        </div>
    </div>

    <div id="deposit-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×”×¤×§×“×” ×œ×™×¢×“</h3>
            <p id="deposit-goal-name" style="margin-bottom:15px; opacity:0.7;">...</p>
            <input type="number" id="deposit-amount" class="qa-input" style="width:100%; margin-bottom:15px" placeholder="×¡×›×•× ×œ×”×¤×§×“×”">
            <input type="hidden" id="deposit-goal-index">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('deposit-modal').classList.remove('open')">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmDeposit()">×”×¤×§×“</button></div>
        </div>
    </div>

    <div id="delete-confirm-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-exclamation-circle" style="font-size:3rem; color:var(--danger); margin-bottom:10px;"></i>
            <h3>×œ××—×•×§ ××ª ×”×™×¢×“?</h3>
            <p style="margin-bottom:20px; color:#666;">×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.</p>
            <input type="hidden" id="delete-goal-index">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 20px;" onclick="document.getElementById('delete-confirm-modal').classList.remove('open')">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--danger); width:auto; padding:10px 20px;" onclick="confirmDeleteGoal()">××—×§</button>
            </div>
        </div>
    </div>
    
    <div id="delete-shift-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-trash-alt" style="font-size:3rem; color:var(--danger); margin-bottom:10px;"></i>
            <h3>×œ××—×•×§ ×¡×•×’ ××©××¨×ª?</h3>
            <p style="margin-bottom:20px; color:#666;">×”× ×ª×•× ×™× ×©×œ ××©××¨×ª ×–×• ×™×™××—×§×•.</p>
            <input type="hidden" id="delete-shift-id">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 20px;" onclick="document.getElementById('delete-shift-modal').classList.remove('open')">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--danger); width:auto; padding:10px 20px;" onclick="performDeleteShift()">××—×§</button>
            </div>
        </div>
    </div>

    <div id="reset-confirm-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-trash-restore" style="font-size:3rem; color:#ff9800; margin-bottom:15px;"></i>
            <h3>×œ××¤×¡ ××ª ×”×—×•×“×©?</h3>
            <p style="color:#666; margin-bottom:20px;">×›×œ ×”××©××¨×•×ª ×™×™××—×§×•.</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="ssc-btn ghost" onclick="document.getElementById('reset-confirm-modal').classList.remove('open')">×‘×™×˜×•×œ</button>
                <button class="ssc-btn danger" onclick="performRealReset()">×›×Ÿ, ××¤×¡</button>
            </div>
        </div>
    </div>

    <div id="custom-alert-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center; padding:30px;">
            <div id="alert-icon" style="font-size:3rem; margin-bottom:15px;">âœ…</div>
            <h3 id="alert-title" style="margin-bottom:10px;">×”×•×“×¢×”</h3>
            <p id="alert-message" style="margin-bottom:25px; color:#666; font-size:1.1rem;">...</p>
            <button class="btn-primary" onclick="closeCustomAlert()">××™×©×•×¨</button>
        </div>
    </div>

    <div id="cat-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×§×˜×’×•×¨×™×” ×—×“×©×”</h3>
            <input type="text" id="new-cat-name" class="qa-input" style="width:100%; margin-bottom:15px" placeholder="×©×">
            <div style="margin-bottom:15px; text-align:right">
                <label style="font-size:0.8rem; color:#666">×¡××œ:</label>
                <div class="emoji-grid"><span class="emoji-opt" onclick="selectEmoji('ğŸ•')">ğŸ•</span><span class="emoji-opt" onclick="selectEmoji('ğŸš—')">ğŸš—</span><span class="emoji-opt" onclick="selectEmoji('ğŸ ')">ğŸ </span><span class="emoji-opt" onclick="selectEmoji('ğŸ‘•')">ğŸ‘•</span></div>
                <input type="text" id="new-cat-emoji" class="qa-input" style="width:100%" placeholder="××• ×”×§×œ×“..." value="ğŸ“">
            </div>
            <input type="number" id="new-cat-limit" class="qa-input" style="width:100%; margin-bottom:15px" placeholder="×ª×§×¦×™×‘">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="closeCategoryModal()">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmAddCategory()">×”×•×¡×£</button></div>
        </div>
    </div>

    <div id="limit-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×¢×“×›×•×Ÿ ×ª×§×¦×™×‘</h3>
            <p id="limit-modal-cat-name" style="margin-bottom:10px"></p>
            <input type="number" id="edit-cat-limit" class="qa-input" style="width:100%; margin-bottom:15px">
            <input type="hidden" id="edit-cat-id">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('limit-modal').classList.remove('open')">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmEditLimit()">×¢×“×›×Ÿ</button></div>
        </div>
    </div>

    <script>
        /* === MAIN APP LOGIC === */
        let currentDate = new Date();
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        let chartInstance = null;
        let chartType = 'bar';
        let postAlertAction = null;

        const motivationQuotes = ["×”×“×¨×š ×œ×¢×•×©×¨ ××ª×—×™×œ×” ×‘×©×§×œ ×”×¨××©×•×Ÿ ×©×—×•×¡×›×™×.", "×œ× ××©× ×” ×›××” ××ª×” ××¨×•×•×™×—, ××©× ×” ×›××” ××ª×” ×©×•××¨.", "×ª×§×¦×™×‘ ×”×•× ×œ× ×›×œ×, ×”×•× ×”××¤×ª×— ×œ×—×•×¤×©.", "×›×¡×£ ×”×•× ××©×¨×ª × ×”×“×¨ ××‘×œ ××“×•×Ÿ × ×•×¨×.", "×”×©×§×¢×” ×‘×¢×¦××š ×× ×™×‘×” ××ª ×”×¨×™×‘×™×ª ×”×’×‘×•×”×” ×‘×™×•×ª×¨.", "×”×•×¦××•×ª ×§×˜× ×•×ª ××¦×˜×‘×¨×•×ª ×œ×”×•×Ÿ ×’×“×•×œ.", "×©×œ×™×˜×” ×‘×›×¡×£ ×”×™× ×©×œ×™×˜×” ×‘×—×™×™×.", "×”×¢×•×©×¨ ×”×××™×ª×™ ×”×•× ×”×©×§×˜ ×”× ×¤×©×™.", "××œ ×ª×§× ×” ××” ×©××ª×” ×œ× ×¦×¨×™×š.", "×ª×§×¦×™×‘ ×—×›× ×”×™×•× = ×—×•×¤×© ×›×œ×›×œ×™ ××—×¨."];

        let appData = JSON.parse(localStorage.getItem('budgetUltimateDataV23')) || {
            categories: [{ id: 1, name: '××–×•×Ÿ', emoji: 'ğŸ•', limit: 2000, items: [] }, { id: 2, name: '×¨×›×‘', emoji: 'ğŸš—', limit: 800, items: [] }, { id: 3, name: '×—×©×‘×•× ×•×ª', emoji: 'ğŸ ', limit: 1500, items: [] }],
            goals: [], bank: 0, monthlySalaries: {}, recurringSettings: [], lastProcessedMonth: "", lastLogin: Date.now(), isPremium: false
        };
        if(!appData.recurringSettings) appData.recurringSettings = [];

        document.addEventListener('DOMContentLoaded', () => {
            if(isDarkMode) document.body.classList.add('dark-mode');
            document.getElementById('bank-input').value = appData.bank || '';
            document.getElementById('motivation-text').innerText = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
            
            checkAndRunRecurring(); updateMonthDisplay(); renderApp(); checkPremiumStatus(); initSalaryCalculator();
            appData.lastLogin = Date.now(); saveData();
        });

        function toggleMenu() {
    document.getElementById('side-menu').classList.toggle('open');
    document.getElementById('menu-overlay').classList.toggle('open');
    
    // ×”× ×” ×”×§×¡×: × ×•×¢×œ/××©×—×¨×¨ ××ª ×”×’×œ×™×œ×” ×©×œ ×›×œ ×”×“×£
    document.body.classList.toggle('no-scroll');
}

        function navTo(pageName) {
            toggleMenu();
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`page-${pageName}`).classList.add('active');
            if(pageName === 'dashboard') renderApp();
            if(pageName === 'recurring') renderRecurringPage();
        }

        function getMonthKey(date) { return `${date.getMonth()}-${date.getFullYear()}`; }
        function updateSalary() { const val = document.getElementById('salary-input').value; const key = getMonthKey(currentDate); if (!appData.monthlySalaries) appData.monthlySalaries = {}; appData.monthlySalaries[key] = val; saveAndRender(); }
        function saveAndRender() { appData.bank = document.getElementById('bank-input').value; saveData(); renderApp(); if (typeof Android !== 'undefined' && Android.updateBalanceWidget) Android.updateBalanceWidget(document.getElementById('global-balance').innerText); }
        function saveData() { localStorage.setItem('budgetUltimateDataV23', JSON.stringify(appData)); }

        function renderApp() {
            const salaryInput = document.getElementById('salary-input'); const key = getMonthKey(currentDate);
            salaryInput.value = (appData.monthlySalaries && appData.monthlySalaries[key]) ? appData.monthlySalaries[key] : '';
            
            const filterCat = document.getElementById('cat-filter'); const currentFilter = filterCat.value;
            filterCat.innerHTML = `<option value="all">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>` + appData.categories.map(c => `<option value="${c.id}">${c.emoji} ${c.name}</option>`).join('');
            filterCat.value = currentFilter;

            const container = document.getElementById('categories-container'); container.innerHTML = '';
            let totalExpenses = 0;

            appData.categories.forEach(cat => {
                if(currentFilter !== 'all' && cat.id != currentFilter) return;
                let filteredItems = cat.items.filter(item => { const d = new Date(item.date); return d.getMonth() === currentDate.getMonth() && d.getFullYear() === currentDate.getFullYear(); });
                const catTotal = filteredItems.reduce((sum, item) => sum + item.amount, 0); totalExpenses += catTotal;
                const spentPos = Math.abs(Math.min(0, catTotal)); const limit = cat.limit || 1000; const percent = Math.min(100, (spentPos / limit) * 100);
                let colorClass = percent > 100 ? 'bg-red' : (percent > 75 ? 'bg-yellow' : 'bg-green'); let balanceStyle = percent >= 100 ? 'color:var(--danger)' : '';

                const card = document.createElement('div'); card.className = 'category-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="cat-info"><div class="cat-emoji">${cat.emoji}</div><div><div style="font-weight:bold">${cat.name}</div><div class="cat-limit" onclick="openLimitModal(${cat.id})">×ª×§×¦×™×‘: ${limit} <i class="fas fa-pen" style="font-size:0.7rem"></i></div></div></div>
                        <div class="current-spend" style="${balanceStyle}">${formatMoney(catTotal)}</div>
                    </div>
                    <div class="progress-track"><div class="progress-fill ${colorClass}" style="width:${percent}%"></div></div>
                    <ul class="items-list">
                        ${filteredItems.map(item => {
                            let icon = item.method === 'cash' ? '<i class="fas fa-money-bill-wave pay-method-icon"></i>' : (item.method === 'transfer' ? '<i class="fas fa-university pay-method-icon"></i>' : '<i class="fas fa-credit-card pay-method-icon"></i>');
                            return `<li class="item-row"><span>${item.text} ${item.isAuto ? '<i class="fas fa-robot"></i>' : ''}</span><div>${icon}<span class="${item.amount < 0 ? 'amount-neg' : 'amount-pos'}">${formatMoney(Math.abs(item.amount))}</span><i class="fas fa-times" onclick="deleteItem(${cat.id}, '${item.id}')" style="margin-right:5px; color:#ccc;"></i></div></li>`
                        }).join('')}
                    </ul>
                    <div class="quick-add">
                        <div class="qa-row"><input id="d-${cat.id}" class="qa-input" placeholder="×ª×™××•×¨"></div>
                        <div class="qa-row"><input id="a-${cat.id}" type="number" class="qa-input" placeholder="×¡×›×•×"><select id="m-${cat.id}" class="qa-input" style="flex:0.5"><option value="credit">ğŸ’³</option><option value="cash">ğŸ’µ</option><option value="transfer">ğŸ¦</option></select></div>
                        <button class="qa-btn" onclick="addItem(${cat.id})"><i class="fas fa-plus"></i> ×”×•×¡×£</button>
                    </div>`;
                container.appendChild(card);
            });

            const bank = parseFloat(appData.bank) || 0; const salary = parseFloat(appData.monthlySalaries?.[key]) || 0; const total = bank + salary + totalExpenses;
            document.getElementById('global-balance').innerText = formatMoney(total); document.getElementById('global-balance').style.color = total < 0 ? 'var(--danger)' : 'white';
            renderHistoryChart(); renderSavings();
        }

        // --- Savings ---
        function renderSavings() {
            const list = document.getElementById('savings-list'); list.innerHTML = '';
            if(!appData.goals) appData.goals = [];
            appData.goals.forEach((goal, i) => {
                const percent = Math.min(100, (goal.current / goal.target) * 100);
                const bg = goal.color || 'linear-gradient(135deg, #a8e063, #56ab2f)';
                const emoji = goal.emoji || 'ğŸ’°';
                const el = document.createElement('div'); el.className = 'saving-card'; el.style.background = bg;
                el.innerHTML = `<div class="saving-header"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:1.5rem;background:rgba(255,255,255,0.2);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;">${emoji}</span><div><div style="font-weight:bold;font-size:1.1rem;">${goal.name}</div><div style="font-size:0.8rem;opacity:0.9;">${formatMoney(goal.current)} / ${formatMoney(goal.target)}</div></div></div></div><div class="saving-progress-bg"><div class="saving-progress-fill" style="width:${percent}%"></div></div><div style="text-align:left; margin-top:10px; display:flex; justify-content:flex-end; gap:10px;"><button style="background:rgba(255,255,255,0.2);border:none;color:white;border-radius:8px;padding:6px 12px;cursor:pointer;font-weight:bold;" onclick="openDepositModal(${i})">+ ×”×¤×§×“×”</button><button style="background:rgba(0,0,0,0.1);border:none;color:white;border-radius:8px;width:30px;cursor:pointer;" onclick="deleteGoal(${i})"><i class="fas fa-trash"></i></button></div>`;
                list.appendChild(el);
            });
        }
        function openGoalModal() { document.getElementById('goal-modal').classList.add('open'); }
        function selectGoalColor(el, color) { document.querySelectorAll('.color-opt').forEach(d => d.classList.remove('selected')); el.classList.add('selected'); document.getElementById('new-goal-color').value = color; }
        function confirmAddGoal() {
            const name = document.getElementById('new-goal-name').value; const target = parseFloat(document.getElementById('new-goal-target').value); const emoji = document.getElementById('new-goal-emoji').value || 'ğŸ’°'; const color = document.getElementById('new-goal-color').value;
            if(name && target) { appData.goals.push({name, target, current:0, emoji, color}); saveAndRender(); document.getElementById('goal-modal').classList.remove('open'); document.getElementById('new-goal-name').value=''; document.getElementById('new-goal-target').value=''; }
        }
        function openDepositModal(index) { document.getElementById('deposit-goal-index').value = index; document.getElementById('deposit-goal-name').innerText = "×¢×‘×•×¨: " + appData.goals[index].name; document.getElementById('deposit-amount').value = ''; document.getElementById('deposit-modal').classList.add('open'); document.getElementById('deposit-amount').focus(); }
        function confirmDeposit() {
            const index = parseInt(document.getElementById('deposit-goal-index').value); const amount = parseFloat(document.getElementById('deposit-amount').value);
            if(amount > 0) { appData.goals[index].current += amount; saveAndRender(); document.getElementById('deposit-modal').classList.remove('open'); }
        }
        function deleteGoal(i) { document.getElementById('delete-goal-index').value = i; document.getElementById('delete-confirm-modal').classList.add('open'); }
        function confirmDeleteGoal() { const i = parseInt(document.getElementById('delete-goal-index').value); appData.goals.splice(i, 1); saveAndRender(); document.getElementById('delete-confirm-modal').classList.remove('open'); }

        // --- Chart ---
        function toggleChartType() { chartType = chartType === 'bar' ? 'pie' : 'bar'; renderHistoryChart(); }
        function renderHistoryChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            let config = {};
            if (chartType === 'bar') {
                let labels = [], data = [];
                for(let i=5; i>=0; i--) { let d = new Date(); d.setMonth(d.getMonth() - i); labels.push(d.toLocaleDateString('he-IL', {month:'short'})); let mTotal = 0; appData.categories.forEach(cat => { cat.items.forEach(item => { let iDate = new Date(item.date); if(iDate.getMonth() === d.getMonth() && iDate.getFullYear() === d.getFullYear()) { if(item.amount < 0) mTotal += Math.abs(item.amount); } }); }); data.push(mTotal); }
                config = { type: 'bar', data: { labels, datasets: [{ label: '×”×•×¦××•×ª', data, backgroundColor: '#4e54c8', borderRadius: 4 }] }, options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } };
            } else {
                let labels = [], data = []; let colors = ['#ff7675', '#74b9ff', '#55efc4', '#a29bfe', '#ffeaa7', '#fd79a8'];
                appData.categories.forEach(cat => { let catSum = 0; cat.items.forEach(item => { let iDate = new Date(item.date); if(iDate.getMonth() === currentDate.getMonth() && iDate.getFullYear() === currentDate.getFullYear()) { if(item.amount < 0) catSum += Math.abs(item.amount); } }); if(catSum > 0) { labels.push(cat.name); data.push(catSum); } });
                config = { type: 'pie', data: { labels, datasets: [{ data, backgroundColor: colors }] }, options: { maintainAspectRatio: false } };
            }
            chartInstance = new Chart(ctx, config);
        }

        // --- Actions ---
        function addItem(catId) {
            const desc = document.getElementById(`d-${catId}`).value; const amount = document.getElementById(`a-${catId}`).value; const method = document.getElementById(`m-${catId}`).value;
            if(!desc || !amount) return;
            const cat = appData.categories.find(c => c.id === catId); const val = parseFloat(amount);
            cat.items.push({ id: Date.now().toString(), text: desc, amount: -Math.abs(val), date: currentDate.toISOString(), method: method });
            saveAndRender();
        }
        
        function deleteItem(catId, itemId) {
            const cat = appData.categories.find(c => c.id === catId);
            if(!cat) return;
            
            const itemToDelete = cat.items.find(i => i.id === itemId);
            
            // Sync Logic: Delete parent recurring if exists
            if (itemToDelete && itemToDelete.fromRecurId) {
                // Automatic deletion from recurring list without confirm prompt (as requested)
                if (appData.recurringSettings) {
                    appData.recurringSettings = appData.recurringSettings.filter(rec => rec.id !== itemToDelete.fromRecurId);
                    // Update local storage immediately to reflect changes in recurring page
                    saveData();
                }
            }

            cat.items = cat.items.filter(i => i.id !== itemId);
            saveAndRender();
        }

        // --- Backup (Fixed with Share API) ---
        function openSettingsModal() { toggleMenu(); document.getElementById('settings-modal').classList.add('open'); }
        async function exportDataJSON() {
            const dataStr = JSON.stringify(appData);
            const fileName = 'budget_backup.json';
            const file = new File([dataStr], fileName, { type: 'application/json' });
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                try { await navigator.share({ files: [file], title: '×’×™×‘×•×™ Budget Master', text: '×”× ×” ×”×’×™×‘×•×™ ×©×œ×™' }); } catch(err) { console.error(err); }
            } else {
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr); const link = document.createElement('a'); link.href = dataUri; link.download = fileName; link.click();
            }
        }
        async function exportToCSV() {
            let csv = "\uFEFF×ª××¨×™×š,×§×˜×’×•×¨×™×”,×ª×™××•×¨,×¡×›×•×,×©×™×˜×”\n";
            appData.categories.forEach(cat => { cat.items.forEach(i => { csv += `${new Date(i.date).toLocaleDateString()},${cat.name},${i.text},${i.amount},${i.method}\n` }); });
            const fileName = 'budget_export.csv';
            const file = new File([csv], fileName, { type: 'text/csv' });
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                try { await navigator.share({ files: [file], title: '×™×™×¦×•× ×œ××§×¡×œ' }); } catch(err) { console.error(err); }
            } else {
                const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csv); const link = document.createElement('a'); link.href = dataUri; link.download = fileName; link.click();
            }
        }
        function importDataJSON(input) { const file = input.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const loadedData = JSON.parse(e.target.result); if(loadedData.categories) { appData = loadedData; saveData(); location.reload(); } } catch(err) { alert("×©×’×™××”"); } }; reader.readAsText(file); }

        // --- Other Utils ---
        function changeMonth(delta) { currentDate.setMonth(currentDate.getMonth() + delta); updateMonthDisplay(); renderApp(); }
        function updateMonthDisplay() { document.getElementById('current-month-display').innerText = currentDate.toLocaleDateString('he-IL', { month: 'long', year: 'numeric' }); }
        function openCategoryModal() { document.getElementById('cat-modal').classList.add('open'); }
        function closeCategoryModal() { document.getElementById('cat-modal').classList.remove('open'); }
        function selectEmoji(e) { document.getElementById('new-cat-emoji').value = e; }
        function confirmAddCategory() { const name = document.getElementById('new-cat-name').value; const limit = document.getElementById('new-cat-limit').value; const emoji = document.getElementById('new-cat-emoji').value || 'ğŸ“'; if(name) { appData.categories.push({ id: Date.now(), name, emoji, limit: parseFloat(limit)||1000, items: [] }); saveAndRender(); closeCategoryModal(); } }
        function openLimitModal(catId) { const cat = appData.categories.find(c => c.id === catId); document.getElementById('edit-cat-id').value = catId; document.getElementById('limit-modal-cat-name').innerText = "×¢×‘×•×¨: " + cat.name; document.getElementById('edit-cat-limit').value = cat.limit; document.getElementById('limit-modal').classList.add('open'); }
        function confirmEditLimit() { const catId = parseInt(document.getElementById('edit-cat-id').value); const newLimit = parseFloat(document.getElementById('edit-cat-limit').value); const cat = appData.categories.find(c => c.id === catId); if(cat && newLimit) { cat.limit = newLimit; saveAndRender(); document.getElementById('limit-modal').classList.remove('open'); } }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')); }
        function formatMoney(n) { return n.toLocaleString('he-IL', { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 }); }
        function checkPremiumStatus() { if(appData.isPremium) { document.querySelectorAll('.ad-spacer').forEach(e=>e.style.display='none'); document.body.style.paddingBottom="80px"; } }
        function buyPremium() { if(confirm("×”×× ×œ××©×¨ ×¨×›×™×©×ª ×¤×¨×™××™×•×?")) { appData.isPremium = true; localStorage.setItem('budgetUltimateDataV23', JSON.stringify(appData)); checkPremiumStatus(); alert("×ª×•×“×” ×©× ×¨×©××ª!"); } }
        
        // --- Recurring (Fixed with Table) ---
        function renderRecurringPage() {
            const container = document.getElementById('recurring-list-container'); container.innerHTML = '';
            const select = document.getElementById('rec-cat-select');
            if(select) select.innerHTML = appData.categories.map(c => `<option value="${c.id}">${c.emoji} ${c.name}</option>`).join('');
            
            if (!appData.recurringSettings || appData.recurringSettings.length === 0) {
                 container.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px; color:#999;">××™×Ÿ ×”×•×¨××•×ª ×§×‘×¢ ××•×’×“×¨×•×ª</td></tr>';
                 return;
            }

            appData.recurringSettings.forEach((rec, index) => {
                const cat = appData.categories.find(c => c.id == rec.catId);
                const catName = cat ? (cat.emoji + ' ' + cat.name) : '×œ× ×™×“×•×¢';
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight:bold;">${rec.text}</td>
                    <td style="color:var(--text-sec); font-size:0.85rem;">${catName}</td>
                    <td style="text-align:center; direction:ltr;">${formatMoney(rec.amount)}</td>
                    <td style="text-align:center;"><button onclick="deleteRecurring(${index})" style="background:rgba(255, 118, 117, 0.1); color:var(--danger); border:none; width:30px; height:30px; border-radius:50%; cursor:pointer;"><i class="fas fa-trash-alt"></i></button></td>
                `;
                container.appendChild(tr);
            });
        }

        function addRecurringSetting() {
            const text = document.getElementById('rec-desc').value;
            const amount = parseFloat(document.getElementById('rec-amount').value);
            const catId = document.getElementById('rec-cat-select').value;

            if(!text || !amount) return;

            const uniqueRecurId = Date.now() + Math.random(); 

            appData.recurringSettings.push({ 
                id: uniqueRecurId, 
                text: text, 
                amount: amount, 
                catId: catId 
            });

            const cat = appData.categories.find(c => c.id == catId);
            if(cat) {
                cat.items.push({
                    id: Date.now().toString(),
                    text: text + ' (×§×‘×•×¢)',
                    amount: -Math.abs(amount),
                    date: currentDate.toISOString(),
                    isAuto: true,
                    method: 'credit',
                    fromRecurId: uniqueRecurId
                });
            }

            saveAndRender();
            document.getElementById('rec-desc').value = '';
            document.getElementById('rec-amount').value = '';
            renderRecurringPage();
            showAppAlert('×‘×•×¦×¢', '×”×”×•×¦××” ×¡×•× ×›×¨× ×” ×•× ×•×¡×¤×” ×œ×—×•×“×© ×”× ×•×›×—×™', 'âœ…');
        }

        function deleteRecurring(index) {
            const settingToDelete = appData.recurringSettings[index];
            appData.recurringSettings.splice(index, 1);
            if (settingToDelete.id) { appData.categories.forEach(cat => { cat.items = cat.items.filter(item => item.fromRecurId !== settingToDelete.id); }); }
            localStorage.setItem('budgetUltimateDataV23', JSON.stringify(appData)); renderRecurringPage(); saveAndRender(); 
        }

        function checkAndRunRecurring() { const now = new Date(); const currentMonthKey = `${now.getMonth()}-${now.getFullYear()}`; if(appData.lastProcessedMonth !== currentMonthKey) { if (appData.recurringSettings) { appData.recurringSettings.forEach(rec => { const cat = appData.categories.find(c => c.id == rec.catId); if(cat) cat.items.push({ id: 'auto_'+Date.now()+Math.random(), text: rec.text, amount: -Math.abs(rec.amount), date: now.toISOString(), isAuto: true, method:'credit' }); }); } appData.lastProcessedMonth = currentMonthKey; localStorage.setItem('budgetUltimateDataV23', JSON.stringify(appData)); } }

        /* === CUSTOM ALERT LOGIC === */
        function showAppAlert(title, message, icon = 'âœ…', callback = null) {
            document.getElementById('alert-title').innerText = title;
            document.getElementById('alert-message').innerText = message;
            document.getElementById('alert-icon').innerText = icon;
            postAlertAction = callback;
            document.getElementById('custom-alert-modal').classList.add('open');
        }
        function closeCustomAlert() {
            document.getElementById('custom-alert-modal').classList.remove('open');
            if (postAlertAction) { postAlertAction(); postAlertAction = null; }
        }

        /* === SSC (CALCULATOR) LOGIC === */
        function initSalaryCalculator() {
            const $ = s => document.querySelector(s);
            const ymDefault = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}`;
            const KEY_MODE = 'ssc:mode'; const KEY_CFG = 'ssc:cfg'; const KEY_GENERIC_CATS = 'ssc:cats_generic'; const KEY_COUNTS_PREFIX = 'ssc:counts:'; const KEY_QUICK_PREFIX = 'ssc:quick:';
            const MISHMAR_CATS = [ {id:'m1', name:'×‘×•×§×¨', slices:[{p:100,h:8}]}, {id:'m2', name:'×¦×”×¨×™×™×', slices:[{p:120,h:8}]}, {id:'m3', name:'×œ×™×œ×”', slices:[{p:150,h:8}]}, {id:'m4', name:'×©×™×©×™ ×¦×”×¨×™×™×:', slices:[{p:120,h:3},{p:250,h:5}]}, {id:'m5', name:'×©×™×©×™/×©×‘×ª ×œ×™×œ×”', slices:[{p:300,h:8}]}, {id:'m6', name:'×©×‘×ª ×‘×•×§×¨/×¦×”×¨×™×™×', slices:[{p:225,h:8}]}, {id:'m7', name:'×¨×¦×£ ×¦×”×¨×™×™× ×œ×‘×•×§×¨', slices:[{p:125,h:2},{p:150,h:6}]}, {id:'m8', name:'×¨×¦×£ ××œ×™×œ×” ×œ×¦×”×¨×™×™×(×›×•×œ×œ ××™×›×•×ª)', slices:[{p:187,h:2},{p:225,h:6}]}, {id:'m15', name:'×¨×¦×£ ××©×‘×ª ×¦×”×¨×™×™× ×œ×¨××©×•×Ÿ ×‘×•×§×¨(××™×›×•×ª)', slices:[{p:187,h:2},{p:225,h:6}]}, {id:'m9', name:'×›×¤×•×œ×” 7-19', slices:[{p:100,h:8},{p:120,h:2},{p:150,h:2}]}, {id:'m10', name:'×›×¤×•×œ×” 8-20', slices:[{p:100,h:7},{p:120,h:2},{p:125,h:1},{p:150,h:2}]}, {id:'m11', name:'×›×¤×•×œ×” 9-21', slices:[{p:100,h:6},{p:120,h:2},{p:125,h:2},{p:150,h:2}]}, {id:'m14', name:'×—×“ ×™×•××™ (06:00-21:00)', slices:[{p:100,h:8},{p:125,h:2},{p:150,h:5}]} ];
            const state = { mode: localStorage.getItem(KEY_MODE) || 'generic', hourly: 0, currency: 'â‚ª', ym: ymDefault, categories: [], counts: {}, quickRows: [] };
            const els = { badge: $('#ssc_modeBadge'), hourly: $('#ssc_hourly'), month: $('#ssc_month'), cur: $('#ssc_currency'), editor: $('#ssc_editorPanel'), newName: $('#ssc_newShiftName'), newSlices: $('#ssc_newShiftSlices'), addSlice: $('#ssc_addSliceBtn'), saveTpl: $('#ssc_saveTemplateBtn'), grid: $('#ssc_grid'), empty: $('#ssc_emptyState'), tShifts: $('#ssc_totalShifts'), tHours: $('#ssc_totalHours'), gTotal: $('#ssc_grandTotal'), details: $('#ssc_details'), dTotal: $('#ssc_detailsTotal'), quick: $('#ssc_quickRows'), addQuick: $('#ssc_addQuick'), quickSum: $('#ssc_quickSum'), secret: $('#ssc_secretCode'), secretBtn: $('#ssc_secretBtn'), resetMonth: $('#ssc_resetMonthBtn') };
            
            loadConfig(); setupMode(); loadData(); renderAll();

            function setupMode(){ if(state.mode === 'mishmar'){ els.badge.textContent='××¦×‘ ××©××¨'; els.badge.className='ssc-glass-badge mishmar'; els.editor.style.display='none'; state.categories=MISHMAR_CATS; } else { els.badge.textContent='××¦×‘ ×¢×¨×™×›×” ×—×•×¤×©×™'; els.badge.className='ssc-glass-badge'; els.editor.style.display='block'; resetEditor(); } }
            function loadConfig(){ try{ const cfg=JSON.parse(localStorage.getItem(KEY_CFG)||'{}'); state.hourly=cfg.hourly||0; els.hourly.value=state.hourly||''; els.month.value=state.ym; }catch(e){} }
            function loadData(){ if(state.mode === 'generic'){ try{state.categories=JSON.parse(localStorage.getItem(KEY_GENERIC_CATS)||'[]');}catch{state.categories=[];} if(!state.categories.length) state.categories=[{id:'g1',name:'××©××¨×ª ×¨×’×™×œ×”',slices:[{p:100,h:8}]}]; } const storeKey=`${KEY_COUNTS_PREFIX}${state.mode}:${state.ym}`; try{state.counts=JSON.parse(localStorage.getItem(storeKey)||'{}');}catch{state.counts={};} const quickKey=`${KEY_QUICK_PREFIX}${state.mode}:${state.ym}`; try{state.quickRows=JSON.parse(localStorage.getItem(quickKey)||'[]');}catch{state.quickRows=[];} }
            function saveData(){ localStorage.setItem(KEY_CFG, JSON.stringify({hourly:state.hourly})); localStorage.setItem(`${KEY_COUNTS_PREFIX}${state.mode}:${state.ym}`, JSON.stringify(state.counts)); localStorage.setItem(`${KEY_QUICK_PREFIX}${state.mode}:${state.ym}`, JSON.stringify(state.quickRows)); if(state.mode === 'generic') localStorage.setItem(KEY_GENERIC_CATS, JSON.stringify(state.categories)); }
            
            function renderAll(){ renderGrid(); renderQuick(); calcAndRenderTotals(); }
            
            function renderGrid(){ 
                els.grid.innerHTML=''; 
                if(!state.categories.length){els.empty.style.display='block'; return;} 
                els.empty.style.display='none'; 
                state.categories.forEach(c=>{ 
                    const n=state.counts[c.id]||0; const info=getShiftInfo(c); const subtotal=payForShift(c)*n; 
                    const card=document.createElement('div'); card.className='ssc-card'; 
                    const delBtn=state.mode==='generic'?`<button class="ssc-del-cat" onclick="sscDeleteCategory('${c.id}')"><i class="fas fa-times"></i></button>`:''; 
                    card.innerHTML=`${delBtn}<h3>${c.name}</h3><div class="ssc-meta">${info.desc}</div><div class="ssc-counter"><div class="ssc-iconbtn" onclick="sscUpdateCount('${c.id}', -1)">âˆ’</div><div class="ssc-count">${n}</div><div class="ssc-iconbtn" onclick="sscUpdateCount('${c.id}', 1)">+</div></div><div class="ssc-meta" style="text-align:end">×¡×”×´×›: <b>${fmt(subtotal)}</b></div>`; 
                    els.grid.appendChild(card); 
                }); 
            }
            
            function renderQuick(){ 
                els.quick.innerHTML=''; 
                state.quickRows.forEach((r,i)=>{ 
                    const div=document.createElement('div'); div.className='ssc-editor-slice'; 
                    div.innerHTML=`<input type="text" class="ssc-inp" value="${r.label||''}" onchange="sscUpdateQuick(${i}, 'label', this.value)" placeholder="×ª×™××•×¨" style="flex:2"><input type="number" class="ssc-inp" value="${r.h}" step="0.5" onchange="sscUpdateQuick(${i}, 'h', this.value)" placeholder="×©×¢×•×ª" style="flex:1;text-align:center"><input type="number" class="ssc-inp" value="${r.p}" onchange="sscUpdateQuick(${i}, 'p', this.value)" placeholder="%" style="flex:1;text-align:center"><button class="ssc-btn-close-slice" onclick="sscRemoveQuick(${i})"><i class="fas fa-times"></i></button>`; 
                    els.quick.appendChild(div); 
                }); 
            }
            
            function calcAndRenderTotals(){ let shifts=0, hours=0, money=0; let tbodyHtml=''; state.categories.forEach(c=>{ const n=state.counts[c.id]||0; if(n>0){ const info=getShiftInfo(c); const subMoney=payForShift(c)*n; const subHours=info.totalHours*n; shifts+=n; hours+=subHours; money+=subMoney; tbodyHtml+=`<tr><td style="text-align:right">${c.name}</td><td>${n}</td><td>${subHours}</td><td>${fmt(subMoney)}</td></tr>`; } }); let qMoney=0; state.quickRows.forEach(r=>{ qMoney+=(state.hourly*(r.p/100)*r.h); }); if(qMoney>0||state.quickRows.length>0){ money+=qMoney; tbodyHtml+=`<tr><td colspan="3" style="text-align:right">×—×•×¤×©×™</td><td>${fmt(qMoney)}</td></tr>`; } els.tShifts.textContent=shifts; els.tHours.textContent=parseFloat(hours.toFixed(2)); els.gTotal.textContent=fmt(money); els.details.innerHTML=tbodyHtml; els.dTotal.textContent=fmt(money); els.quickSum.textContent=fmt(qMoney); }

            function resetEditor(){ els.newName.value=''; els.newSlices.innerHTML=''; addEditorSlice(100, 8); }
            function addEditorSlice(p=100, h=0){ 
                const div=document.createElement('div'); div.className='ssc-editor-slice'; 
                div.innerHTML=`
                    <div style="flex:1; display:flex; flex-direction:column;"><span style="font-size:10px;color:#666">××—×•×– (%)</span><input type="number" class="ssc-inp e-p" value="${p}"></div>
                    <div style="flex:1; display:flex; flex-direction:column;"><span style="font-size:10px;color:#666">×©×¢×•×ª</span><input type="number" class="ssc-inp e-h" value="${h}" step="0.5"></div>
                    <button class="ssc-btn-close-slice" onclick="this.parentElement.remove()" style="margin-top:15px;"><i class="fas fa-times"></i></button>
                `; 
                els.newSlices.appendChild(div); 
            }
            
            function getShiftInfo(c){ let h=0; const parts=c.slices.map(s=>{ h+=+s.h; return `${s.p}%Ã—${s.h}×©×³`; }); return {totalHours:h, desc:`${h} ×©×¢×•×ª (${parts.join(' + ')})`}; }
            function payForShift(c){ if(!state.hourly)return 0; return c.slices.reduce((sum,s)=>sum+(state.hourly*(s.p/100)*s.h),0); }
            function fmt(n){ return 'â‚ª' + n.toLocaleString('he-IL',{maximumFractionDigits:0}); }

            window.sscUpdateCount=(id,delta)=>{ state.counts[id]=Math.max(0,(state.counts[id]||0)+delta); saveData(); renderAll(); };
            window.sscDeleteCategory=(id)=>{ if(!confirm('×œ××—×•×§?'))return; state.categories=state.categories.filter(c=>c.id!==id); delete state.counts[id]; saveData(); renderAll(); };
            window.sscUpdateQuick=(i,k,v)=>{ state.quickRows[i][k]=(k==='label')?v:+v; saveData(); renderAll(); };
            window.sscRemoveQuick=(i)=>{ state.quickRows.splice(i,1); saveData(); renderAll(); };
            window.sscAddQuickRow = () => { state.quickRows.push({h:0, p:100, label:''}); saveData(); renderQuick(); };
            window.sscResetMonth = () => { document.getElementById('reset-confirm-modal').classList.add('open'); };
            window.performRealReset = () => { state.counts={}; state.quickRows=[]; saveData(); renderAll(); document.getElementById('reset-confirm-modal').classList.remove('open'); };
            window.sscAddEditorSlice = () => addEditorSlice();

            els.hourly.oninput=()=>{ state.hourly=+els.hourly.value; saveData(); renderAll(); };
            els.month.onchange=()=>{ state.ym=els.month.value; loadData(); renderAll(); };
            els.saveTpl.onclick=()=>{ const name=els.newName.value.trim(); const slices=[]; els.newSlices.querySelectorAll('.ssc-editor-slice').forEach(div=>{ const p=+div.querySelector('.e-p').value; const h=+div.querySelector('.e-h').value; if(h>0)slices.push({p,h}); }); if(!name||!slices.length)return showAppAlert('×©×’×™××”','× × ×œ×”×–×™×Ÿ ×©× ×•×œ×¤×—×•×ª ××“×¨×’×” ××—×ª','âš ï¸'); state.categories.push({id:'g'+Date.now(),name,slices}); saveData(); renderAll(); resetEditor(); };
        }

        // === GLOBAL EVENT LISTENER FOR SECRET CODE ===
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'ssc_secretBtn') {
                var input = document.getElementById('ssc_secretCode');
                if (!input) return;
                var val = input.value.trim();
                if (val === '××©××¨') {
                    localStorage.setItem('ssc:mode', 'mishmar');
                    showAppAlert('××¦×‘ ××©××¨', '×”×¤×¨×•×¤×™×œ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! ××¨×¢× ×Ÿ...', 'ğŸ‘®â€â™‚ï¸', function() { location.reload(); });
                } else if (val === '×¨×’×™×œ' || val === 'generic') {
                    localStorage.setItem('ssc:mode', 'generic');
                    showAppAlert('××¦×‘ ×¢×¨×™×›×”', '×—×–×¨×ª ×œ××¦×‘ ×—×•×¤×©×™.', 'âœï¸', function() { location.reload(); });
                } else {
                    showAppAlert('×©×’×™××”', '×§×•×“ ×œ× ×—×•×§×™', 'âŒ');
                }
            }
        });
    </script>
</body>
</html>



